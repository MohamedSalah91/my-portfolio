name: CI/CD Pipeline for Portfolio

on:
  push:
    branches: ["master"]
  pull_request:
    branches: ["master"]

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v3

      - name: ğŸ§¹ Lint YAML files
        run: |
          pip install yamllint
          yamllint . || true

      - name: ğŸ” Validate project structure
        run: |
          echo "Checking required files..."
          test -f Dockerfile || { echo "âŒ Dockerfile not found"; exit 1; }
          test -f src/index.html || { echo "âŒ index.html not found"; exit 1; }
          test -f src/style.css || { echo "âŒ style.css not found"; exit 1; }
          echo "âœ… Project structure is valid"

      - name: ğŸ³ Build Docker image
        run: |
          docker build -t portfolio:${{ github.sha }} .

      - name: ğŸ§ª Test Docker container
        run: |
          docker run -d --name test-container -p 8080:80 \
            portfolio:${{ github.sha }}
          sleep 5
          STATUS_CODE=$(
            curl -s -o /dev/null -w "%{http_code}" \
            http://localhost:8080 || echo "000"
          )
          if [ "$STATUS_CODE" != "200" ]; then
            echo "âŒ Container test failed (HTTP $STATUS_CODE)"
            exit 1
          fi
          echo "âœ… Container responding correctly"
          docker stop test-container
          docker rm test-container
          