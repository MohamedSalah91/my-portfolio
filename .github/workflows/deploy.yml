name: CI/CD Pipeline for Portfolio

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¥ Checkout code
      uses: actions/checkout@v3
    
    - name: ðŸ” Validate project structure
      run: |
        echo "Checking required files..."
        if [ ! -f "Dockerfile" ]; then
          echo "âŒ ERROR: Dockerfile not found!"
          exit 1
        fi
        if [ ! -f "src/index.html" ]; then
          echo "âŒ ERROR: index.html not found!"
          exit 1
        fi
        echo "âœ… All required files are present"
    
    - name: ðŸ³ Build Docker image
      run: |
        echo "Building Docker image..."
        docker build -t portfolio:${{ github.sha }} .
        echo "âœ… Docker image built successfully"
    
    - name: ðŸ§ª Test Docker container
      run: |
        echo "Testing Docker container..."
        # Ø´ØºÙ„ Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ù…Ø¤Ù‚ØªØ§Ù‹ Ù„Ù„ØªØ¬Ø±Ø¨Ø©
        docker run -d --name test-container -p 8080:80 portfolio:${{ github.sha }}
        sleep 5
        
        # Ø§Ø®ØªØ¨Ø± Ø¥Ø°Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø´ØºØ§Ù„
        echo "Testing HTTP response..."
        STATUS_CODE=$(curl -s -o /dev/null -w "%{http_code}" http://localhost:8080 || echo "000")
        
        if [ "$STATUS_CODE" = "200" ]; then
          echo "âœ… Container is responding correctly (HTTP 200)"
        else
          echo "âŒ ERROR: Container not responding properly (HTTP $STATUS_CODE)"
          exit 1
        fi
        
        # Ø£ÙˆÙ‚Ù ÙˆÙ†Ø¸Ù
        docker stop test-container
        docker rm test-container
    
    - name: ðŸ“Š Success report
      run: |
        echo "## ðŸŽ‰ CI/CD Pipeline Results" >> $GITHUB_STEP_SUMMARY
        echo "**Status:** âœ… SUCCESS" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ðŸ“‹ Build Details:" >> $GITHUB_STEP_SUMMARY
        echo "- **Docker Image:** portfolio:${{ github.sha }}" >> $GITHUB_STEP_SUMMARY
        echo "- **Commit:** ${{ github.sha }}" >> $GITHUB_STEP_SUMMARY
        echo "- **Branch:** ${{ github.ref }}" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### âœ… All checks passed!" >> $GITHUB_STEP_SUMMARY